name: Discord Bot

on:
  workflow_dispatch:   # start it manually from Actions tab
  # You can also enable a cron to relaunch periodically if you want:
  # schedule:
  #   - cron: '0 * * * *'   # every hour

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360   # max 6 hours; GH may still stop earlier

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'   # or the Node version you use locally

      - name: Install dependencies
        run: npm ci || npm install

      - name: Create .env file from secrets
        run: |
          echo "DISCORD_TOKEN=${{ secrets.DISCORD_TOKEN }}" >> .env
          echo "CLIENT_ID=${{ secrets.CLIENT_ID }}" >> .env
          echo "WEATHERAPI_KEY=${{ secrets.WEATHERAPI_KEY }}" >> .env

      - name: Start bot
        run: node index.js
